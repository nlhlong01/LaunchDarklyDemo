"use strict";function e(n){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}function n(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function t(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function r(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(o,!0).forEach(function(e){n(r,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(o).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function o(e){function n(e,n){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=n}return(n.prototype=new Error).name=e,n.prototype.constructor=n}Object.defineProperty(exports,"__esModule",{value:!0});var i=o("LaunchDarklyUnexpectedResponseError"),a=o("LaunchDarklyInvalidEnvironmentIdError"),u=o("LaunchDarklyInvalidUserError"),s=o("LaunchDarklyInvalidEventKeyError"),c=o("LaunchDarklyInvalidArgumentError"),l=o("LaunchDarklyFlagFetchError");function f(e){return!(400<=e&&e<500)||400===e||408===e||429===e}for(var v=Object.freeze({__proto__:null,LDUnexpectedResponseError:i,LDInvalidEnvironmentIdError:a,LDInvalidUserError:u,LDInvalidEventKeyError:s,LDInvalidArgumentError:c,LDFlagFetchError:l,isHttpErrorRecoverable:f}),d=function(e){for(var n,t=e.length,r=t%3,o=[],i=0,a=t-r;i<a;i+=16383)o.push(b(e,i,a<i+16383?a:i+16383));return 1==r?(n=e[t-1],o.push(g[n>>2]+g[n<<4&63]+"==")):2==r&&(n=(e[t-2]<<8)+e[t-1],o.push(g[n>>10]+g[n>>4&63]+g[n<<2&63]+"=")),o.join("")},g=[],m=[],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,y=p.length;h<y;++h)g[h]=p[h],m[p.charCodeAt(h)]=h;function b(e,n,t){for(var r,o,i=[],a=n;a<t;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(g[(o=r)>>18&63]+g[o>>12&63]+g[o>>6&63]+g[63&o]);return i.join("")}m["-".charCodeAt(0)]=62,m["_".charCodeAt(0)]=63;var k=Array.isArray,E=Object.keys,w=Object.prototype.hasOwnProperty,S=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==typeof n&&"object"==typeof t){var r,o,i,a=k(n),u=k(t);if(a&&u){if((o=n.length)!=t.length)return!1;for(r=o;0!=r--;)if(!e(n[r],t[r]))return!1;return!0}if(a!=u)return!1;var s=n instanceof Date,c=t instanceof Date;if(s!=c)return!1;if(s&&c)return n.getTime()==t.getTime();var l=n instanceof RegExp,f=t instanceof RegExp;if(l!=f)return!1;if(l&&f)return n.toString()==t.toString();var v=E(n);if((o=v.length)!==E(t).length)return!1;for(r=o;0!=r--;)if(!w.call(t,v[r]))return!1;for(r=o;0!=r--;)if(!e(n[i=v[r]],t[i]))return!1;return!0}return n!=n&&t!=t},P=["key","secondary","ip","country","email","firstName","lastName","avatar","name"];function O(e){var n=unescape(encodeURIComponent(e));return d(function(e){for(var n=[],t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}(n))}function D(e){return O(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function U(e){return JSON.parse(JSON.stringify(e))}function j(e,n){return S(e,n)}function I(e){setTimeout(e,0)}function R(e,n){var t=e.then(function(e){return n&&setTimeout(function(){n(null,e)},0),e},function(e){if(!n)return Promise.reject(e);setTimeout(function(){n(e,null)},0)});return n?void 0:t}function N(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]={value:e[t],version:0});return n}function F(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t].value);return n}function T(e,n){for(var t,r=n.slice(0),o=[],i=e;0<r.length;){for(t=[];0<i;){var a=r.shift();if(!a)break;(i-=D(JSON.stringify(a)).length)<0&&0<t.length?r.unshift(a):t.push(a)}i=e,o.push(t)}return o}function L(e){var n=e.version||"2.14.1";return e.userAgent+"/"+n}function A(e){return{"X-LaunchDarkly-User-Agent":L(e)}}function C(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce(function(e,n){return r({},e,{},n)},{})}function x(e){if(!e)return e;var n;for(var t in P){var o=P[t],i=e[o];void 0!==i&&"string"!=typeof i&&((n=n||r({},e))[o]=String(i))}return n||e}var q=Object.freeze({__proto__:null,btoa:O,base64URLEncode:D,clone:U,deepEquals:j,onNextTick:I,wrapPromiseCallback:R,transformValuesToVersionedValues:N,transformVersionedValuesToValues:F,chunkUserEventsForUrl:T,getLDUserAgentString:L,getLDHeaders:A,extend:C,sanitizeUser:x}),_=2e3;function J(c,l,e,v){var d=l+"/events/bulk/"+e,g=l+"/a/"+e+".gif",n={};function p(e){(new window.Image).src=e}return n.sendEvents=function(e){if(!c.httpRequest)return Promise.resolve();var n,t,r,o,i,a=c.httpAllowsPost();n=a?[e]:T(_-l.length,e);for(var u=[],s=0;s<n.length;s++)u.push((t=n[s],r=a,o=void 0,o=v||p,i=JSON.stringify(t),r?function n(t){var e=C({"Content-Type":"application/json","X-LaunchDarkly-Event-Schema":"3"},A(c));return c.httpRequest("POST",d,e,i).promise.then(function(e){if(e)return 400<=e.status&&f(e.status)&&t?n(!1):function(e){var n={status:e.status},t=e.header("date");if(t){var r=Date.parse(t);r&&(n.serverTime=r)}return n}(e)}).catch(function(){return t?n(!1):Promise.reject()})}(!0).catch(function(){}):(o(g+"?d="+D(i)),Promise.resolve())));return Promise.all(u)},n}function V(e){var n={},s=e.allAttributesPrivate,c=e.privateAttributeNames||[],l={key:!0,custom:!0,anonymous:!0},f={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return n.filterUser=function(e){if(!e)return null;function n(o,i){return Object.keys(o).reduce(function(e,n){var t,r=e;return i(n)&&(l[t=n]||!s&&-1===a.indexOf(t)&&-1===c.indexOf(t)?r[0][n]=o[n]:r[1][n]=!0),r},[{},{}])}var a=e.privateAttributeNames||[],t=n(e,function(e){return f[e]}),r=t[0],o=t[1];if(e.custom){var i=n(e.custom,function(){return!0});r.custom=i[0],o=C({},o,i[1])}var u=Object.keys(o);return u.length&&(u.sort(),r.privateAttrs=u),r},n}function z(e){return e&&e.message?e.message:"string"==typeof e||e instanceof String?e:JSON.stringify(e)}var K=function(){return"LaunchDarkly client initialized"},$=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",M=function(){return"Be sure to call `identify` in the LaunchDarkly client: https://docs.launchdarkly.com/docs/js-sdk-reference#section-analytics-events"},H=function(e){return'Expected application/json content type but got "'+e+'"'},G=function(){return"localStorage is unavailable"},X=function(){return"localStorage is unavailable, so anonymous user ID cannot be cached"},B=function(e){return"network error"+(e?" ("+e+")":"")},W=function(e){return'Custom event "'+e+'" does not exist'},Q=function(){return"Environment not found. Double check that you specified a valid environment/client-side ID."+$},Y=function(){return"No environment/client-side ID was specified."+$},Z=function(e){return"Error fetching flag settings: "+z(e)},ee=function(){return"No user specified."+$},ne=function(){return"Invalid user specified."+$},te=function(){return"LaunchDarkly client was initialized with bootstrap data that did not include flag metadata. Events may not be sent correctly."+$},re=function(){return"LaunchDarkly bootstrap data is not available because the back end could not read the flags."},oe=function(e,n){return n?'[LaunchDarkly] "'+e+'" is deprecated, please use "'+n+'"':'[LaunchDarkly] "'+e+'" is deprecated'},ie=function(e,n,t){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+n+" - "+(f(e)?t:"giving up permanently")},ae=function(){return"Cannot make HTTP requests in this environment."+$},ue=function(){return"identify() has no effect here; it must be called on the main client instance"},se=function(){return"Closing stream connection"},ce=function(e){return"Opening stream connection to "+e},le=function(e,n){return"Error on stream connection: "+z(e)+", will continue retrying every "+n+" milliseconds."},fe=function(e){return"polling for feature flags at "+e},ve=function(){return"received ping message from stream"},de=function(){return"received streaming update for all flags"},ge=function(e){return'received streaming update for flag "'+e+'"'},me=function(e){return'received streaming update for flag "'+e+'" but ignored due to version check'},pe=function(e){return'received streaming deletion for flag "'+e+'"'},he=function(e){return'received streaming deletion for flag "'+e+'" but ignored due to version check'},ye=function(e){return'enqueueing "'+e+'" event'},be=function(e){return"sending "+e+" events"},ke=Object.freeze({__proto__:null,clientInitialized:K,clientNotReady:function(){return"LaunchDarkly client is not ready"},eventWithoutUser:M,invalidContentType:H,invalidKey:function(){return"Event key must be a string"},localStorageUnavailable:G,localStorageUnavailableForUserId:X,networkError:B,unknownCustomEventKey:W,environmentNotFound:Q,environmentNotSpecified:Y,errorFetchingFlags:Z,userNotSpecified:ee,invalidUser:ne,bootstrapOldFormat:te,bootstrapInvalid:re,deprecated:oe,httpErrorMessage:ie,httpUnavailable:ae,identifyDisabled:ue,streamClosing:se,streamConnecting:ce,streamError:le,debugPolling:fe,debugStreamPing:ve,debugStreamPut:de,debugStreamPatch:ge,debugStreamPatchIgnored:me,debugStreamDelete:pe,debugStreamDeleteIgnored:he,debugEnqueueingEvent:ye,debugPostingEvents:be});function Ee(e,n,t){var r,a,u,s,o,c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,l={},v=(4<arguments.length&&void 0!==arguments[4]?arguments[4]:null)||J(e,n.eventsUrl,t),d=(u=a=0,s={},(r={}).summarizeEvent=function(e){if("feature"===e.kind){var n=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),t=s[n];t?t.count=t.count+1:s[n]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===a||e.creationDate<a)&&(a=e.creationDate),e.creationDate>u&&(u=e.creationDate)}},r.getSummary=function(){var e={},n=!0;for(var t in s){var r=s[t],o=e[r.key];o||(o={default:r.default,counters:[]},e[r.key]=o);var i={value:r.value,count:r.count};void 0!==r.variation&&null!==r.variation&&(i.variation=r.variation),r.version?i.version=r.version:i.unknown=!0,o.counters.push(i),n=!1}return n?null:{startDate:a,endDate:u,features:e}},r.clearSummary=function(){u=a=0,s={}},r),g=V(n),p=n.inlineUsersInEvents,h=n.samplingInterval,m=n.flushInterval,y=n.logger,w=[],b=0,k=!1;function E(){return 0===h||0===Math.floor(Math.random()*h)}return l.enqueue=function(e){if(!k){var n,t=!1,r=!1;if(d.summarizeEvent(e),"feature"===e.kind?E()&&(t=!!e.trackEvents,r=!!(n=e).debugEventsUntilDate&&n.debugEventsUntilDate>b&&n.debugEventsUntilDate>(new Date).getTime()):t=E(),t&&w.push((a=C({},i=e),p||"identify"===i.kind?a.user=g.filterUser(i.user):(a.userKey=i.user.key,delete a.user),"feature"===i.kind&&(delete a.trackEvents,delete a.debugEventsUntilDate),a)),r){var o=C({},e,{kind:"debug"});delete o.trackEvents,delete o.debugEventsUntilDate,delete o.variation,w.push(o)}}var i,a},l.flush=function(){if(k)return Promise.resolve();var e=w,n=d.getSummary();return d.clearSummary(),n&&(n.kind="summary",e.push(n)),0===e.length?Promise.resolve():(w=[],y.debug(be(e.length)),v.sendEvents(e).then(function(e){e&&(e.serverTime&&(b=e.serverTime),f(e.status)||(k=!0),400<=e.status&&I(function(){c.maybeReportError(new i(ie(e.status,"event posting","some events were dropped")))}))}))},l.start=function(){o=setTimeout(function e(){l.flush(),o=setTimeout(e,m)},m)},l.stop=function(){clearTimeout(o)},l}function we(n){var e={},o={};return e.on=function(e,n,t){o[e]=o[e]||[],o[e]=o[e].concat({handler:n,context:t})},e.off=function(e,n,t){if(o[e])for(var r=0;r<o[e].length;r++)o[e][r].handler===n&&o[e][r].context===t&&(o[e]=o[e].slice(0,r).concat(o[e].slice(r+1)))},e.emit=function(e){if(o[e])for(var n=0;n<o[e].length;n++)o[e][n].handler.apply(o[e][n].context,Array.prototype.slice.call(arguments,1))},e.getEvents=function(){return Object.keys(o)},e.getEventListenerCount=function(e){return o[e]?o[e].length:0},e.maybeReportError=function(e){e&&(o.error?this.emit("error",e):(n||console).error(e.message))},e}function Se(t,r,o,i,a){var u={};function s(){var e="",n=i.getUser();return n&&(e=o||O(JSON.stringify(n))),"ld:"+r+":"+e}return u.loadFlags=function(){return t.get(s()).then(function(e){if(null==e)return null;try{var n=JSON.parse(e);if(n){var t=n.$schema;void 0===t||t<1?n=N(n):delete n.$schema}return n}catch(e){return u.clearFlags().then(function(){return Promise.reject(e)})}}).catch(function(e){return a.warn(G()),Promise.reject(e)})},u.saveFlags=function(e){var n=C({},e,{$schema:1});return t.set(s(),JSON.stringify(n)).catch(function(e){return a.warn(G()),Promise.reject(e)})},u.clearFlags=function(){return t.clear(s()).catch(function(e){return a.warn(G()),Promise.reject(e)})},u}var Pe="application/json";function Oe(p,e,u){var s=e.baseUrl,c=e.useReport,f=e.evaluationReasons,h=e.sendLDHeaders,v=e.logger,n={},m={};function d(e,n){if(!p.httpRequest)return new Promise(function(e,n){n(new l(ae()))});var t=n?"REPORT":"GET",r=h?A(p):{};n&&(r["Content-Type"]="application/json");var o,i,u,s,c,f,v=m[e];v||(o=function(){delete m[e]},(f={addPromise:function(n,e){i=n,u&&u(),u=e,n.then(function(e){i===n&&(s(e),o())},function(e){i===n&&(c(e),o())})}}).resultPromise=new Promise(function(e,n){s=e,c=n}),v=f,m[e]=v);var d=p.httpRequest(t,e,r,n),g=d.promise.then(function(e){if(200!==e.status)return Promise.reject(404===(n=e).status?new a(Q()):new l(Z(n.statusText||String(n.status))));if(e.header("content-type")&&0===e.header("content-type").lastIndexOf(Pe))return JSON.parse(e.body);var n,t=H(e.header("content-type")||"");return Promise.reject(new l(t))},function(e){return Promise.reject(new l(B(e)))});return v.addPromise(g,function(){d.cancel&&d.cancel()}),v.resultPromise}return n.fetchJSON=function(e){return d(s+e,null)},n.fetchFlagSettings=function(e,n){var t,r,o,i="";return c?(r=[s,"/sdk/evalx/",u,"/user"].join(""),o=JSON.stringify(e)):(t=D(JSON.stringify(e)),r=[s,"/sdk/evalx/",u,"/users/",t].join("")),n&&(i="h="+n),f&&(i=i+(i?"&":"")+"withReasons=true"),r=r+(i?"?":"")+i,v.debug(fe(r)),d(r,o)},n}for(var De=function(e,n){return function(e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var t=new Uint8Array(16);e.exports=function(){return n(t),t}}else{var r=new Array(16);e.exports=function(){for(var e,n=0;n<16;n++)0==(3&n)&&(e=4294967296*Math.random()),r[n]=e>>>((3&n)<<3)&255;return r}}}(n={exports:{}}),n.exports}(),Ue=[],je=0;je<256;++je)Ue[je]=(je+256).toString(16).substr(1);var Ie,Re,Ne=function(e,n){var t=n||0,r=Ue;return[r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]]].join("")},Fe=0,Te=0,Le=function(e,n,t){var r=n&&t||0,o=n||[],i=(e=e||{}).node||Ie,a=void 0!==e.clockseq?e.clockseq:Re;if(null==i||null==a){var u=De();null==i&&(i=Ie=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==a&&(a=Re=16383&(u[6]<<8|u[7]))}var s=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:Te+1,l=s-Fe+(c-Te)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||Fe<s)&&void 0===e.nsecs&&(c=0),1e4<=c)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Fe=s,Re=a;var f=(1e4*(268435455&(s+=122192928e5))+(Te=c))%4294967296;o[r++]=f>>>24&255,o[r++]=f>>>16&255,o[r++]=f>>>8&255,o[r++]=255&f;var v=s/4294967296*1e4&268435455;o[r++]=v>>>8&255,o[r++]=255&v,o[r++]=v>>>24&15|16,o[r++]=v>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var d=0;d<6;++d)o[r+d]=i[d];return n||Ne(o)},Ae="ld:$anonUserId";function Ce(o,i){var e={};return e.validateUser=function(e){if(!e)return Promise.reject(new u(ee()));var r=U(e);return null!==r.key&&void 0!==r.key?(r.key=r.key.toString(),Promise.resolve(r)):r.anonymous?(o?o.get(Ae).catch(function(){return null}):Promise.resolve(null)).then(function(e){if(e)return r.key=e,r;var n,t=Le();return r.key=t,(n=t,o?o.set(Ae,n).catch(function(){i.warn(X())}):Promise.resolve()).then(function(){return r})}):Promise.reject(new u(ne()))},e}function xe(e,n){var o,i=["debug","info","warn","error"];o=null!=n?""===n?"":n+" ":"LD: ";var a=0;e&&(a="none"===e?100:i.indexOf(e));var t={};function r(e,n,t){if(a<=e){var r=e<i.length?i[e]:"?";n(o+"["+r+"] "+t)}}return t.debug=function(e){return r(0,console.log,e)},t.info=function(e){return r(1,console.info,e)},t.warn=function(e){return r(2,console.warn,e)},t.error=function(e){return r(3,console.error,e)},t}var qe="ready",_e="initialized",Je="failed",Ve="change",ze="internal-change";function Ke(n,t,o,i,u){var f,v,d,g,p,h,m,y,w,b,k,E,S,P,O,T,N,L,A,q,_,z,J,V,$,H,X,B,Q,ee,ne,ie=o&&o.logger?o.logger:u&&u.logger||xe("warn"),ae=we(ie),fe=(J=o,V=ae,H=C({logger:$=ie},{baseUrl:"https://app.launchdarkly.com",streamUrl:"https://clientstream.launchdarkly.com",eventsUrl:"https://events.launchdarkly.com",sendEvents:!0,sendLDHeaders:!0,inlineUsersInEvents:!1,allowFrequentDuplicateEvents:!1,sendEventsOnlyForVariation:!1,useReport:!1,evaluationReasons:!1,flushInterval:2e3,samplingInterval:0,streamReconnectDelay:1e3,allAttributesPrivate:!1,privateAttributeNames:[]},u),X={all_attributes_private:"allAttributesPrivate",private_attribute_names:"privateAttributeNames",samplingInterval:null},ne=C({},J||{}),ee=ne,Object.keys(X).forEach(function(e){if(void 0!==ee[e]){var n=X[e];$&&$.warn(oe(e,n)),n&&(void 0===ee[n]&&(ee[n]=ee[e]),delete ee[e])}}),B=H,Q=C({},ne),Object.keys(B).forEach(function(e){void 0!==Q[e]&&null!==Q[e]||(Q[e]=B[e])}),ne=Q,(isNaN(ne.flushInterval)||ne.flushInterval<2e3)&&(ne.flushInterval=2e3,We("Invalid flush interval configured. Must be an integer >= 2000 (milliseconds).")),(isNaN(ne.samplingInterval)||ne.samplingInterval<0)&&(ne.samplingInterval=0,We("Invalid sampling interval configured. Sampling interval must be an integer >= 0.")),ne),be=fe.hash,ke=fe.sendEvents,Pe=n,De=(m=i,w=Pe,b=be,k=(y=fe).streamUrl,E=y.logger,S={},P=k+"/eval/"+w,O=y.useReport,T=y.evaluationReasons,N=y.streamReconnectDelay,L=!1,z=_=q=A=null,S.connect=function(e,t){function n(n){z[n]=function(e){L=!1,t[n]&&t[n](e)}}for(var r in _=e,z={},t||{})n(r);Me()},S.disconnect=function(){clearTimeout(q),q=null,Xe()},S.isConnected=function(){return!!(A&&m.eventSourceIsActive&&m.eventSourceIsActive(A))},S),Re=fe.eventProcessor||Ee(i,fe,Pe,ae),Ue=Oe(i,fe,Pe),je={},Ie={},Te=fe.streaming,Ne=!1,Le=!1,Fe=!0,Ae=fe.stateProvider,Ge=(p=function(e){Ae||e&&Be({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})},{setUser:function(e){(h=x(e))&&p&&p(U(h))},getUser:function(){return h?U(h):null}}),$e=Ce(i.localStorage,ie);function Ke(e){L||(E.warn(le(e,N)),L=!0),Xe(),Me(N)}function Me(e){q||(e?q=setTimeout(He,e):He())}function He(){var e;q=null;var n="",t={};if(m.eventSourceFactory){for(var r in null!=b&&(n="h="+b),O?m.eventSourceAllowsReport?(e=P,t.method="REPORT",t.headers={"Content-Type":"application/json"},t.body=JSON.stringify(_)):(e=k+"/ping/"+w,n=""):e=P+"/"+D(JSON.stringify(_)),T&&(n=n+(n?"&":"")+"withReasons=true"),e=e+(n?"?":"")+n,Xe(),E.info(ce(e)),A=m.eventSourceFactory(e,t),z)z.hasOwnProperty(r)&&A.addEventListener(r,z[r]);A.onerror=Ke}}function Xe(){A&&(E.info(se()),A.close(),A=null)}function We(e){I(function(){V&&V.maybeReportError(new c(e))})}function Be(e){Pe&&(Ae&&Ae.enqueueEvent&&Ae.enqueueEvent(e)||(e.user?(Fe=!1,!ke||Le||i.isDoNotTrack()||(ie.debug(ye(e.kind)),Re.enqueue(e))):Fe&&(ie.warn(M()),Fe=!1)))}function Ze(e,n,t,r){var o=Ge.getUser(),i=new Date,a=n?n.value:null;if(!fe.allowFrequentDuplicateEvents){var u=JSON.stringify(a)+(o&&o.key?o.key:"")+e,s=je[u];if(s&&i-s<3e5)return;je[u]=i}var c={kind:"feature",key:e,user:o,value:a,variation:n?n.variationIndex:null,default:t,creationDate:i.getTime()},l=Ie[e];l&&(c.version=l.flagVersion?l.flagVersion:l.version,c.trackEvents=l.trackEvents,c.debugEventsUntilDate=l.debugEventsUntilDate),(r||l&&l.trackReason)&&n&&(c.reason=n.reason),Be(c)}function Qe(e,n,t,r){var o;if(Ie&&Ie.hasOwnProperty(e)&&Ie[e]&&!Ie[e].deleted){var i=Ie[e];o=Ye(i),null!==i.value&&void 0!==i.value||(o.value=n)}else o={value:n,variationIndex:null,reason:{kind:"ERROR",errorKind:"FLAG_NOT_FOUND"}};return t&&Ze(e,o,n,r),o}function Ye(e){return{value:e.value,variationIndex:void 0===e.variation?null:e.variation,reason:e.reason||null}}function en(){v=!0,Ge.getUser()&&De.connect(Ge.getUser(),{ping:function(){ie.debug(ve()),Ue.fetchFlagSettings(Ge.getUser(),be).then(function(e){return tn(e||{})}).catch(function(e){ae.maybeReportError(new l(Z(e)))})},put:function(e){var n=JSON.parse(e.data);ie.debug(de()),tn(n)},patch:function(e){var n=JSON.parse(e.data),t=Ie[n.key];if(!t||!t.version||!n.version||t.version<n.version){ie.debug(ge(n.key));var r={},o=C({},n);delete o.key;var i=Ye(Ie[n.key]=o);r[n.key]=t?{previous:t.value,current:i}:{current:i},rn(r)}else ie.debug(me(n.key))},delete:function(e){var n=JSON.parse(e.data);if(!Ie[n.key]||Ie[n.key].version<n.version){ie.debug(pe(n.key));var t={};Ie[n.key]&&!Ie[n.key].deleted&&(t[n.key]={previous:Ie[n.key].value}),Ie[n.key]={version:n.version,deleted:!0},rn(t)}else ie.debug(he(n.key))}})}function nn(){v&&(De.disconnect(),v=!1)}function tn(e){var n={};if(!e)return Promise.resolve();for(var t in Ie)Ie.hasOwnProperty(t)&&Ie[t]&&(e[t]&&!j(e[t].value,Ie[t].value)?n[t]={previous:Ie[t].value,current:Ye(e[t])}:e[t]&&!e[t].deleted||(n[t]={previous:Ie[t].value}));for(var o in e)e.hasOwnProperty(o)&&e[o]&&(!Ie[o]||Ie[o].deleted)&&(n[o]={current:Ye(e[o])});return Ie=r({},e),rn(n).catch(function(){})}function rn(o){var e=Object.keys(o);if(0<e.length){var i={};e.forEach(function(e){var n=o[e].current,t=n?n.value:void 0,r=o[e].previous;ae.emit(Ve+":"+e,t,r),i[e]=n?{current:t,previous:r}:{previous:r}}),ae.emit(Ve,i),ae.emit(ze,Ie),fe.sendEventsOnlyForVariation||Ae||e.forEach(function(e){Ze(e,o[e].current)})}return f&&g?g.saveFlags(Ie).catch(function(){return null}):Promise.resolve()}function on(){var e=Te||d&&void 0===Te;e&&!v?en():!e&&v&&nn()}function an(e){return e===Ve||e.substr(0,Ve.length+1)===Ve+":"}i.localStorage&&(g=new Se(i.localStorage,Pe,be,Ge,ie));var un=new Promise(function(e){var n=ae.on(qe,function(){ae.off(qe,n),e()})}),sn=new Promise(function(e,n){var t=ae.on(_e,function(){ae.off(_e,t),e()}),r=ae.on(Je,function(e){ae.off(Je,r),n(e)})});if("string"==typeof fe.bootstrap&&"LOCALSTORAGE"===fe.bootstrap.toUpperCase()&&(g?f=!0:ie.warn(G())),"object"===e(fe.bootstrap)&&(Ie=function(t){var e=Object.keys(t),r=t.$flagsState;!r&&e.length&&ie.warn(te()),!1===t.$valid&&ie.warn(re());var o={};return e.forEach(function(e){if("$flagsState"!==e&&"$valid"!==e){var n={value:t[e]};r&&r[e]?n=C(n,r[e]):n.version=0,o[e]=n}}),o}(fe.bootstrap)),Ae){var cn=Ae.getInitialState();cn?ln(cn):Ae.on("init",ln),Ae.on("update",function(e){e.user&&Ge.setUser(e.user),e.flags&&tn(e.flags)})}else(n?$e.validateUser(t).then(function(n){return Ge.setUser(n),"object"===e(fe.bootstrap)?fn():f?g.loadFlags().catch(function(){return null}).then(function(e){return null==e?(Ie={},Ue.fetchFlagSettings(Ge.getUser(),be).then(function(e){return tn(e||{})}).then(fn).catch(function(e){vn(new l(Z(e)))})):(Ie=e,I(fn),Ue.fetchFlagSettings(Ge.getUser(),be).then(function(e){return tn(e)}).catch(function(e){return ae.maybeReportError(e)}))}):Ue.fetchFlagSettings(Ge.getUser(),be).then(function(e){Ie=e||{},fn()}).catch(function(e){Ie={},vn(e)})}):Promise.reject(new a(Y()))).catch(function(e){return ae.maybeReportError(e)});function ln(e){Pe=e.environment,Ge.setUser(e.user),Ie=r({},e.flags),I(fn)}function fn(){ie.info(K()),Ne=!0,on(),ae.emit(qe),ae.emit(_e)}function vn(e){ae.maybeReportError(e),ae.emit(Je,e),ae.emit(qe)}return{client:{waitForInitialization:function(){return sn},waitUntilReady:function(){return un},identify:function(e,n,t){return Le?R(Promise.resolve({}),t):Ae?(ie.warn(ue()),R(Promise.resolve(F(Ie)),t)):R((f&&g?g.clearFlags():Promise.resolve()).then(function(){return $e.validateUser(e)}).then(function(e){return Ge.setUser(e)}).then(function(){return Ue.fetchFlagSettings(Ge.getUser(),n)}).then(function(e){var n=F(e);return e?tn(e).then(function(){return n}):n}).then(function(e){return v&&en(),e}).catch(function(e){return ae.maybeReportError(e),Promise.reject(e)}),t)},getUser:function(){return Ge.getUser()},variation:function(e,n){return Qe(e,n,!0,!1).value},variationDetail:function(e,n){return Qe(e,n,!0,!0)},track:function(e,n,t){if("string"==typeof e){i.customEventFilter&&!i.customEventFilter(e)&&ie.warn(W(e));var r={kind:"custom",key:e,user:Ge.getUser(),url:i.getCurrentUrl(),creationDate:(new Date).getTime()};null!=n&&(r.data=n),null!=t&&(r.metricValue=t),Be(r)}else ae.maybeReportError(new s(W(e)))},on:function(e,n,t){an(e)?(d=!0,Ne&&on(),ae.on(e,n,t)):ae.on.apply(ae,arguments)},off:function(e){if(ae.off.apply(ae,arguments),an(e)){var n=!1;ae.getEvents().forEach(function(e){an(e)&&0<ae.getEventListenerCount(e)&&(n=!0)}),n||(d=!1,v&&void 0===Te&&nn())}},setStreaming:function(e){var n=null===e?void 0:e;n!==Te&&(Te=n,on())},flush:function(e){return R(ke?Re.flush():Promise.resolve(),e)},allFlags:function(){var e={};if(!Ie)return e;for(var n in Ie)Ie.hasOwnProperty(n)&&(e[n]=Qe(n,null,!fe.sendEventsOnlyForVariation).value);return e},close:function(e){if(Le)return R(Promise.resolve(),e);function n(){Le=!0,Ie={}}return R(Promise.resolve().then(function(){if(nn(),ke)return Re.stop(),Re.flush()}).then(n).catch(n),e)}},options:fe,emitter:ae,ident:Ge,logger:ie,requestor:Ue,start:function(){ke&&Re.start()},enqueueEvent:Be,getFlagsInternal:function(){return Ie},getEnvironmentId:function(){return Pe},internalChangeEventName:ze}}function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ownKeys(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function _objectSpread2(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}function isSyncXhrSupported(){var e=window.navigator&&window.navigator.userAgent;if(e){var n=e.match(/Chrom(e|ium)\/([0-9]+)\./);if(n)return parseInt(n[2],10)<73}return!0}var emptyResult={promise:Promise.resolve({status:200,header:function(){return null},body:null})};function newHttpRequest(e,n,t,r,o){if(o&&!isSyncXhrSupported())return emptyResult;var i=new window.XMLHttpRequest;for(var a in i.open(e,n,!o),t||{})t.hasOwnProperty(a)&&i.setRequestHeader(a,t[a]);if(o)return i.send(r),emptyResult;var u;return{promise:new Promise(function(e,n){i.addEventListener("load",function(){u||e({status:i.status,header:function(e){return i.getResponseHeader(e)},body:i.responseText})}),i.addEventListener("error",function(){u||n(new Error)}),i.send(r)}),cancel:function(){u=!0,i.abort()}}}function makeBrowserPlatform(e){var n,i={};i.synchronousFlush=!1,window.XMLHttpRequest&&(i.httpRequest=function(e,n,t,r){var o=i.synchronousFlush;return i.synchronousFlush=!1,newHttpRequest(e,n,t,r,o)}),i.httpAllowsPost=function(){return void 0===n&&(n=!!window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest),n};var r,t=e&&e.eventUrlTransformer;i.getCurrentUrl=function(){return t?t(window.location.href):window.location.href},i.isDoNotTrack=function(){var e;return 1===(e=window.navigator&&void 0!==window.navigator.doNotTrack?window.navigator.doNotTrack:window.navigator&&void 0!==window.navigator.msDoNotTrack?window.navigator.msDoNotTrack:window.doNotTrack)||!0===e||"1"===e||"yes"===e};try{window.localStorage&&(i.localStorage={get:function(n){return new Promise(function(e){e(window.localStorage.getItem(n))})},set:function(n,t){return new Promise(function(e){window.localStorage.setItem(n,t),e()})},clear:function(n){return new Promise(function(e){window.localStorage.removeItem(n),e()})}})}catch(e){i.localStorage=null}var o=e&&e.useReport;if(r=o&&"function"==typeof window.EventSourcePolyfill&&window.EventSourcePolyfill.supportedOptions&&window.EventSourcePolyfill.supportedOptions.method?(i.eventSourceAllowsReport=!0,window.EventSourcePolyfill):(i.eventSourceAllowsReport=!1,window.EventSource),window.EventSource){i.eventSourceFactory=function(e,n){var t=_objectSpread2({},{heartbeatTimeout:3e5,silentTimeout:3e5,skipDefaultHeaders:!0},{},n);return new r(e,t)},i.eventSourceIsActive=function(e){return e.readyState===window.EventSource.OPEN||e.readyState===window.EventSource.CONNECTING}}return i.userAgent="JSClient",i}var matchOperatorsRe=/[|\\{}()[\]^$+*?.]/g,escapeStringRegexp=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(matchOperatorsRe,"\\$&")};function doesUrlMatch(e,n,t,r){var o,i,a=n.replace(t,"").replace(r,"");switch(e.kind){case"exact":i=n,o=new RegExp("^"+escapeStringRegexp(e.url)+"/?$");break;case"canonical":i=a,o=new RegExp("^"+escapeStringRegexp(e.url)+"/?$");break;case"substring":i=a,o=new RegExp(".*"+escapeStringRegexp(e.substring)+".*$");break;case"regex":i=a,o=new RegExp(e.pattern);break;default:return!1}return o.test(i)}function findGoalsForClick(e,n){for(var t=[],r=0;r<n.length;r++)for(var o=e.target,i=n[r],a=i.selector,u=document.querySelectorAll(a);o&&0<u.length;){for(var s=0;s<u.length;s++)o===u[s]&&t.push(i);o=o.parentNode}return t}function GoalTracker(e,r){for(var n={},t=null,o=[],i=0;i<e.length;i++)for(var a=e[i],u=a.urls||[],s=0;s<u.length;s++)if(doesUrlMatch(u[s],window.location.href,window.location.search,window.location.hash)){"pageview"===a.kind?r("pageview",a):(o.push(a),r("click_pageview",a));break}return 0<o.length&&(t=function(e){for(var n=findGoalsForClick(e,o),t=0;t<n.length;t++)r("click",n[t])},document.addEventListener("click",t)),n.dispose=function(){document.removeEventListener("click",t)},n}var locationWatcherInterval=300;function GoalManager(r,n){var t,o,e={};function i(){o&&o.dispose(),t&&t.length&&(o=GoalTracker(t,a))}function a(e,n){var t={kind:e,key:n.key,data:null,url:window.location.href,user:r.ident.getUser(),creationDate:(new Date).getTime()};return"click"===e&&(t.selector=n.selector),r.enqueueEvent(t)}function u(e,n){var t,r=window.location.href;function o(){(t=window.location.href)!==r&&(r=t,n())}!function e(n,t){n(),setTimeout(function(){e(n,t)},t)}(o,e),window.history&&window.history.pushState?window.addEventListener("popstate",o):window.addEventListener("hashchange",o)}return e.goalKeyExists=function(e){if(!t)return!0;for(var n=0;n<t.length;n++)if("custom"===t[n].kind&&t[n].key===e)return!0;return!1},r.requestor.fetchJSON("/sdk/goals/"+r.getEnvironmentId()).then(function(e){e&&0<e.length&&(o=GoalTracker(t=e,a),u(locationWatcherInterval,i)),n()}).catch(function(e){r.emitter.maybeReportError(new v.LDUnexpectedResponseError((e&&e.message,e.message))),n()}),e}var goalsEvent="goalsReady",extraDefaults={fetchGoals:!0};function initialize(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=makeBrowserPlatform(t),o=Ke(e,n,t,r,extraDefaults),i=o.client,a=o.options,u=o.emitter,s=new Promise(function(e){var n=u.on(goalsEvent,function(){u.off(goalsEvent,n),e()})});if(i.waitUntilGoalsReady=function(){return s},a.fetchGoals){var c=GoalManager(o,function(){return u.emit(goalsEvent)});r.customEventFilter=c.goalKeyExists}else u.emit(goalsEvent);"complete"!==document.readyState?window.addEventListener("load",o.start):o.start();function l(){r.synchronousFlush=!0,i.flush().catch(function(){})}return window.addEventListener("beforeunload",l),window.addEventListener("unload",l),i}var createConsoleLogger=xe,version="2.15.2";function deprecatedInitialize(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return console&&console.warn&&console.warn(ke.deprecated("default export","named LDClient export")),initialize(e,n,t)}var index={initialize:deprecatedInitialize,version:version};exports.createConsoleLogger=createConsoleLogger,exports.default=index,exports.initialize=initialize,exports.version=version;
//# sourceMappingURL=ldclient.cjs.js.map
